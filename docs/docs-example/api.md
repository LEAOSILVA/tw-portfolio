---
sidebar_position: 1
---

# API documentation

> **Context**
>
>Documenting Sensedia Analytics API.

## Overview

**Sensedia Analytics** is a solution designed to help you **manage metrics and export traces efficiently**.  

With the metrics and database provided by Sensedia Analytics, you can create custom dashboards and tailor how you search and export trace data.  

The **Sensedia Analytics API** allows you to:  
- Consult calls and traces using **OpenSearch Query DSL**.  
- Retrieve logs using multiple filters.  

**OpenSearch** is a distributed search and analytics engine derived from Elasticsearch. It enables you to store, search, and analyze large volumes of data quickly and in near real-time.  

The **Query DSL (Domain Specific Language)** is OpenSearch’s JSON-based language for defining searches. It allows you to create precise and complex queries, filter results, and aggregate data efficiently. Using Query DSL, you can perform searches such as full-text matching, phrase matching, range queries, and nested object queries, all structured in JSON, which the API accepts in POST requests for calls and traces.  

### Authentication

All endpoints require Bearer authentication with JWT. Include the token in the `Authorization` header:

`Authorization: Bearer <your_jwt_token>`

### Usage limits 

To optimize the use of API Analytics and reduce potential issues, the following limits are in place:

- Response payload size: 6 MB
- Response timeout: 29 seconds
- Rate limit: 600 requests per second

:::note[NOTE]
This threshold may be adjusted at any time without prior notice to maintain service stability and prevent misuse.
:::

### Resources

You can manage three resources using the POST and GET methods: 

- [Calls](#calls)

- [Traces](#traces)

- [Logs](#logs)

Check out what each one of them represents and is used for:

| Resource | What it represents | Key use |
|----------|------------------|---------|
| **Call** | An individual API request or operation executed by a service. | Monitoring individual requests, analyzing performance, detecting errors per operation. |
| **Trace** | The full journey of a request across multiple services, composed of one or more spans. | Understanding request flows, service dependencies, and pinpointing bottlenecks or failures. |
| **Log** | A record of events or messages generated by services or applications. | Troubleshooting, auditing events, correlating with calls and traces for detailed system insight. |

**In short:**  
- **Calls** track individual requests.  
- **Traces** track the entire path of a request through the system.  
- **Logs** record events or messages that provide context for calls and traces.

### Calls

#### POST

##### Endpoint

-  `analytics/v1/products/{product_name}/calls/query` 
Retrieves calls data from OpenSearch using Query DSL.

##### Parameters

| Parameters   | Required  |Type   |Where | Description         |
|--------------|-----------|------ |------|---------------------|
|`product_name`| Yes       |String |Path  | Name of the product.|

##### Request body

```json
{
  "query": {
    "match_phrase": {
      "trace_id": "string"
    }
  }
}
```
##### Responses

:::note[NOTE]
Example responses. Actual response may vary.
:::

**200**
- Successful query. OpenSearch returns data.

```json
{
  "took": 12,
  "timed_out": false,
  "_shards": {
    "total": 5,
    "successful": 5,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 1.0,
    "hits": [
      {
        "_index": "calls-index",
        "_id": "abc123",
        "_score": 1.0,
        "_source": {
          "trace_id": "123e4567-e89b-12d3-a456-426614174000",
          "product_name": "my-product",
          "timestamp": "2025-09-25T14:10:00Z",
          "status": "SUCCESS",
          "operation": "createOrder",
          "duration_ms": 245,
          "caller_ip": "192.168.0.10"
        }
      }
    ]
  }
}
```

**400**
- Validation error. 

```json
[
  {
    "field": "startDate",
    "message": "The value must follow the date format (YYYY-MM-DD).",
    "code": "0002"
  }
]
```

**401/403**      
- Access error. Check your access token. 

```json
{
  "message": "Authentication failed. Check your access token.",
  "code": "0003"
}
```

**404/500**      
- Resource or internal error.   

```json
{
  "message": "The requested resource was not found.",
  "code": "0001"
}           
```
### Traces

#### POST

##### Endpoint

- `analytics/v1/products/{product_name}/traces/query` 
Retrieves trace data from OpenSearch using Query DSL.

##### Parameters

| Parameters   | Required  |Type  | Where | Description          |
|--------------|-----------|----- |-------|--------------------  |
|`product_name`| Yes       |String| Path  | Name of the product. |

##### Request body

```json
{
  "query": {
    "match_phrase": {
      "trace_id": "string"
    }
  }
}
```

##### Responses

:::note[NOTE]
Example responses. Actual response may vary.
:::

**200**
- Successful query. OpenSearch returns data.

```json
{
  "took": 15,
  "timed_out": false,
  "_shards": {
    "total": 5,
    "successful": 5,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 2,
      "relation": "eq"
    },
    "max_score": 1.0,
    "hits": [
      {
        "_index": "traces-index",
        "_id": "trace123",
        "_score": 1.0,
        "_source": {
          "trace_id": "123e4567-e89b-12d3-a456-426614174000",
          "product_name": "my-product",
          "spans": [
            {
              "span_id": "span1",
              "parent_span_id": null,
              "name": "GET /users",
              "kind": 1,
              "start_time": "2025-09-25T14:10:00Z",
              "end_time": "2025-09-25T14:10:05Z",
              "status": "OK"
            },
            {
              "span_id": "span2",
              "parent_span_id": "span1",
              "name": "Query database",
              "kind": 2,
              "start_time": "2025-09-25T14:10:01Z",
              "end_time": "2025-09-25T14:10:03Z",
              "status": "OK"
            }
          ]
        }
      },
      {
        "_index": "traces-index",
        "_id": "trace124",
        "_score": 1.0,
        "_source": {
          "trace_id": "223e4567-e89b-12d3-a456-426614174001",
          "product_name": "my-product",
          "spans": [
            {
              "span_id": "span1",
              "parent_span_id": null,
              "name": "POST /orders",
              "kind": 1,
              "start_time": "2025-09-25T14:15:00Z",
              "end_time": "2025-09-25T14:15:07Z",
              "status": "OK"
            }
          ]
        }
      }
    ]
  }
}
```

**400**
- Validation error. 

```json
[
  {
		 
    "field": "endDate",
    "message": "This field is required and cannot be empty.",
    "code": "0002"
  }
]
```
**401/403**      
- Access error. Check your access token. 

```json
{
  "message": "Authentication failed. Check your access token.",
  "code": "0003"
}
```
**404/500**      
- Resource or internal error.   

```json
{
  "message": "The requested resource was not found.",
  "code": "0001"
}   
```
#### GET

##### Endpoint

- `analytics/v1/products/{product_name}/traces/{trace_id}` 
Retrieves individual traces by ID.

##### Parameters

| Parameters   | Required  |Type   |Where  |Description           |
|--------------|-----------|-------|-------|----------------------|
|`product_name`| Yes       |String |Path   | Name of the product. |
|`trace_id`    | Yes       |String |Path   | Trace identification.|

##### Responses

:::note[NOTE]
Example responses. Actual response may vary.
:::

**200**
- Successful query. Returns JSON with trace details, including headers and detailed body.

```json
{
  "statusCode": 200,
  "headers": {
    "Access-Control-Allow-Headers": "Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,tenantid",
    "Access-Control-Allow-Methods": "OPTIONS,GET",
    "Access-Control-Allow-Origin": "*"
  },
  "multiValueHeaders": null,
  "body": {
    "resource_spans": [
      {
        "resource": {
          "attributes": [
            { "key": "service.name", "value": { "value": { "string_value": "persons" } } },
            { "key": "telemetry.sdk.language", "value": { "value": { "string_value": "java" } } },
            { "key": "telemetry.sdk.name", "value": { "value": { "string_value": "opentelemetry" } } },
            { "key": "telemetry.sdk.version", "value": { "value": { "string_value": "1.18.0" } } }
          ]
        },
        "scope_spans": [
          {
            "scope": { "name": "test" },
            "spans": [
              {
                "trace_id": "C/5NTeKVOoRnefcO4qs08A==",
                "span_id": "lLA4+CendzY=",
                "parent_span_id": "vYKeyNxfgMw=",
                "name": "método async",
                "kind": 1,
                "start_time_unix_nano": 1673880552186859047,
                "end_time_unix_nano": 1673880552237004635,
                "attributes": [
                  { "key": "sensedia.appName", "value": { "value": { "string_value": "appTeste" } } },
                  { "key": "sensedia.billing", "value": { "value": { "bool_value": false } } },
                  { "key": "sensedia.product.name", "value": { "value": { "string_value": "api-platform" } } },
                  { "key": "sensedia.tenant.id", "value": { "value": { "string_value": "tst1" } } }
                ],
                "status": {}
              },
              {
                "trace_id": "C/5NTeKVOoRnefcO4qs08A==",
                "span_id": "LXSHyEvFD7Y=",
                "parent_span_id": "HcoWFgd5AMs=",
                "name": "chamando o address",
                "kind": 1,
                "start_time_unix_nano": 1673880552186741386,
                "end_time_unix_nano": 1673880552267081004,
                "attributes": [
                  { "key": "sensedia.product.name", "value": { "value": { "string_value": "api-platform" } } },
                  { "key": "sensedia.tenant.id", "value": { "value": { "string_value": "tst1" } } }
                ],
                "status": {}
              },
              {
                "trace_id": "C/5NTeKVOoRnefcO4qs08A==",
                "span_id": "HcoWFgd5AMs=",
                "parent_span_id": "vYKeyNxfgMw=",
                "name": "buscando no banco",
                "kind": 1,
                "start_time_unix_nano": 1673880552186360224,
                "end_time_unix_nano": 1673880552267095689,
                "attributes": [
                  { "key": "sensedia.product.name", "value": { "value": { "string_value": "api-platform" } } },
                  { "key": "sensedia.tenant.id", "value": { "value": { "string_value": "tst1" } } }
                ],
                "status": {}
              },
              {
                "trace_id": "C/5NTeKVOoRnefcO4qs08A==",
                "span_id": "vYKeyNxfgMw=",
                "name": "busca pessoas",
                "kind": 1,
                "start_time_unix_nano": 1673880552186203000,
                "end_time_unix_nano": 1673880552267097911,
                "attributes": [
                  { "key": "http.status_code", "value": { "value": { "string_value": "201" } } },
                  { "key": "sensedia.accessTokenOwner", "value": { "value": { "string_value": "Owner" } } },
                  { "key": "http.request.header.access_token", "value": { "value": { "string_value": "844bc8f2-f213-4178-9cdf-9a026de57a07" } } },
                  { "key": "component", "value": { "value": { "string_value": "API" } } },
                  { "key": "sensedia.targetResultStatus", "value": { "value": { "string_value": "200" } } },
                  { "key": "sensedia.environmentName", "value": { "value": { "string_value": "Production" } } },
                  { "key": "http.route", "value": { "value": { "string_value": "persons" } } },
                  { "key": "sensedia.appName", "value": { "value": { "string_value": "appTeste" } } },
                  { "key": "sensedia.targetDurationMillis", "value": { "value": { "string_value": "1000" } } },
                  { "key": "sensedia.environmentId", "value": { "value": { "string_value": "5" } } },
                  { "key": "sensedia.billing", "value": { "value": { "string_value": "false" } } },
                  { "key": "http.method", "value": { "value": { "string_value": "GET" } } },
                  { "key": "status", "value": { "value": { "string_value": "true" } } },
                  { "key": "sensedia.tenant.id", "value": { "value": { "string_value": "tst1" } } },
                  { "key": "service.name", "value": { "value": { "string_value": "persons" } } },
                  { "key": "http.url", "value": { "value": { "string_value": "https://staging.sensedia.com/persons" } } },
                  { "key": "sensedia.resourceId", "value": { "value": { "string_value": "1234" } } },
                  { "key": "sensedia.operationId", "value": { "value": { "string_value": "1" } } },
                  { "key": "sensedia.revisionId", "value": { "value": { "string_value": "143" } } },
                  { "key": "sensedia.documentSize", "value": { "value": { "string_value": "567" } } },
                  { "key": "sensedia.product.name", "value": { "value": { "string_value": "api-platform" } } }
                ],
                "status": {}
              }
            ]
          }
        ]
      }
    ]
  }
}
```
*
**400**
- Validation error. 

```json
[
  {
		 
    "field": "endDate",
    "message": "This field is required and cannot be empty.",
    "code": "0002"
  }
]
```
**401/403**      
- Access error. Check your access token. 

```json
{
  "message": "Authentication failed. Check your access token.",
  "code": "0003"
}
```
**404/500**      
- Resource or internal error.   

```json
{
  "message": "The requested resource was not found.",
  "code": "0001"
}   
```
### Logs

#### GET

##### Endpoint

- `analytics/v1/products/{product_name}/logs`
Returns logs from a product and a tenant id. It allows several filters.

##### Parameters

| Parameters            | Required | Type           | Where  | Description |
|-----------------------|----------|----------------|--------|-------------|
| `product_name`        | Yes      | String         | Path   | Name of the product.|
| `tenant_id`           | Yes      | String         | Header | Tenant identification.|
| `start_timestamp`     | No       | String         | Query  | Log query start date (e.g., 2022-12-31).|
| `end_timestamp`       | No       | String         | Query  | Log query end date (e.g., 2022-12-31).|
| `trace_id`            | No       | String         | Query  | Trace identification connected to the log.|
| `span_id`             | No       | String         | Query  | Span identification connected to the log.|
| `trace_flags`         | No       | Boolean        | Query  | Flag that informs if a log is connected to a trace.|
| `severity_text`       | No       | String         | Query  | Log severity level (e.g., info, debug, warn).|
| `severity_number`     | No       | Number         | Query  | Log severity level in number format (e.g., 5).|
| `service_name`        | No       | String         | Query  | Name of the service that generated the log at the opentelemetry level (e.g., api-platform).|
| `body`                | No       | Array[string]  | Query  | Generated log content (structured or unstructured) (e.g., `"http_method":"get"` or `"": "get"`).|
| `resource_attributes` | No       | Array[string]  | Query  | Attributes within the resource field (e.g., `sensedia.somekey.someprop,somevalue`).|
| `log_attributes`      | No       | Array[string]  | Query  | Attributes within the log following the opentelemetry standard (e.g., `http.status_code,200`). |
| `page`                | No       | Number         | Query  | Current page number (e.g., 1).|
| `size`                | No       | Number         | Query  | Number of logs per page (e.g., 20).|
| `sort`                | No       | String         | Query  | Log sorting field. Available values: `timestamp`, `trace_id`, `span_id`, `trace_flags`, `severity_text`, `severity_number`, `service_name`.|
| `order`               | No       | String         | Query  | Log sorting type. Available values: `asc`, `desc`.|

##### Responses

:::note[NOTE]
Example responses. Actual response may vary.
:::

**200**
-  Successful query. Returns log arrays.

```json
[
  {
    "timestamp": "2019-08-24T14:15:22Z",
    "trace_id": "02377f2c2ac3141761ccfee95ea6b92f",
    "span_id": "bdf3ae75ed68b1c6",
    "trace_flags": true,
    "severity_text": "INFO",
    "severity_number": 9,
    "service_name": "api-platform",
    "body": "log test",
    "resource_attributes": {},
    "log_attributes": {}
  }
]
```
**400**
- Validation error.

```json
{
  "errors": [
    {
      "code": "001",
      "message": "The value must follow the date format (YYYY-MM-DD).",
      "field": "startDate"
    }
  ]
}

```
**500**
- Internal error.

```json
{
  "errors": [
    {
      "code": "001",
      "message": "An unexpected error occurred while processing the request."
    }
  ]
}

```
